# =====================================================
# COMMON CONFIGURATION (ALL ENVIRONMENTS)
# =====================================================
# PROFILE SWITCHER
# LOCAL development:
#spring.profiles.active=dev
# PRODUCTION (Heroku):
spring.profiles.active=prod
# =====================================================

# ========================================
# DATABASE - COMMON SETTINGS
# ========================================
# Connection details in profile-specific files
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver

# ========================================
# HIKARI CONNECTION POOL - BASELINE
# Conservative defaults - profile-specific overrides in dev/prod properties
# ========================================
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
# CRITICAL: Detects connection leaks (logs warning if connection held > 60s)
spring.datasource.hikari.leak-detection-threshold=60000
# Pool name for easier debugging in logs
spring.datasource.hikari.pool-name=TimesheetHikariPool

# ========================================
# LOGGING - CONNECTION POOL MONITORING
# ========================================
# Enable HikariCP debug logging for connection pool diagnostics
logging.level.com.zaxxer.hikari=INFO
logging.level.com.zaxxer.hikari.pool.HikariPool=DEBUG

# ========================================
# JPA/HIBERNATE - COMMON SETTINGS
# ========================================
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.globally_quoted_identifiers=true
spring.jpa.properties.hibernate.globally_quoted_identifiers_skip_column_definitions=true

# ========================================
# CORS - COMMON CONFIGURATION
# ========================================
cors.allowed-origins=https://timesheet.robgro.dev,http://localhost:8080,http://localhost:3000,http://localhost:5173,null
cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,HEAD
cors.allowed-headers=Authorization,Content-Type,X-Requested-With,Accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers
cors.allow-credentials=true
cors.max-age=3600

# ========================================
# SWAGGER/OPENAPI - COMMON CONFIGURATION
# ========================================
springdoc.swagger-ui.disable-swagger-default-url=true
springdoc.swagger-ui.config-url=/api-docs/swagger-config
springdoc.swagger-ui.try-it-out-enabled=true
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.url=/api-docs
springdoc.use-fqn=true
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.tags-sorter=alpha
springdoc.api-docs.version=OPENAPI_3_0

# ========================================
# SPRING COMMON SETTINGS
# ========================================
spring.web.resources.add-mappings=true
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.main.allow-circular-references=true
spring.mvc.hiddenmethod.filter.enabled=true

# ========================================
# SCHEDULING - COMMON (enable/disable in profiles)
# ========================================
# Cron expression: Every 1st day of month at 3pm
scheduling.invoicing.cron=0 0 15 1 * ?
scheduling.invoicing.admin-email=contact@robgro.dev
scheduling.invoicing.send-summary-email=true
scheduling.invoicing.send-empty-client-warning=true

# ========================================
# EMAIL TRACKING - COMMON
# ========================================
# URL and enable/disable in profiles (environment-specific)
app.email-tracking.notification-email=contact@robgro.dev
app.email-tracking.enabled=true
app.email-tracking.send-instant-report=true
app.email-tracking.token-expiry-days=90

# ========================================
# JWT - COMMON
# ========================================
# Secrets in profiles (environment-specific)
# Using fallback values if not set (for dev)
app.jwt.expiration=${JWT_EXPIRATION:86400000}

# ========================================
# EMAIL CONFIGURATION - COMMON
# ========================================
# FROM address for automated system emails (noreply)
app.email.from=noreply@robgro.dev
# Support contact email (shown in email content as help link)
app.support.email=contact@robgro.dev

# ========================================
# SMTP - COMMON (Alwaysdata)
# ========================================
spring.mail.host=smtp-robgro.alwaysdata.net
spring.mail.port=587
spring.mail.username=noreply@robgro.dev
spring.mail.password=${SMTP_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# ========================================
# DEFAULT PROFILE (IF NO ENV VAR SET)
# ========================================
# This prevents accidentally connecting to production!
spring.profiles.default=dev
