<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{head :: head}">
    <!-- Fallback content -->
</head>
<body>
<!-- Back button icon (mobile only, fixed position) -->
<button type="button" class="mobile-back-btn" onclick="window.location.href='/'" aria-label="Back to main menu">
    ‚Üê
</button>

<div class="container my-3">
    <div class="row justify-content-center">
        <div class="col-12 col-md-9">
            <div class="card">
                <div class="card-body p-4">
                    <h2 class="text-center mb-4">Check Invoice Items</h2>

                    <!-- Error message display -->
                    <div th:if="${error}" class="alert alert-danger" role="alert">
                        <span th:text="${error}"></span>
                    </div>

                    <!-- Success message display -->
                    <div th:if="${success}" class="alert alert-success" role="alert">
                        <span th:text="${success}"></span>
                    </div>

                    <form method="post" th:action="@{/invoices/items}">
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <label>Invoice for:</label>
                                <select class="form-control" id="clientId" name="clientId" required>
                                    <option value="">Select client</option>
                                    <option th:each="client : ${clients}"
                                            th:value="${client.id}"
                                            th:text="${client.clientName}">
                                    </option>
                                </select>
                                <label>Seller:</label>
                                <select class="form-control" id="sellerId" name="sellerId" required>
                                    <option value="">Select seller</option>
                                    <option th:each="seller : ${sellers}"
                                            th:value="${seller.id}"
                                            th:text="${seller.name}"
                                            th:if="${seller.active}"
                                            th:selected="${currentUser != null && currentUser.defaultSeller != null && currentUser.defaultSeller.id == seller.id}">
                                    </option>
                                </select>
                                <label>Invoice date:</label>
                                <input type="date" class="form-control"
                                       name="issueDate" required>
                            </div>
                        </div>

                        <div class="table-responsive mb-4">
                            <table class="table invoice-items-table">
                                <thead>
                                <tr>
                                    <th>Select</th>
                                    <th>Client</th>
                                    <th>Service Date</th>
                                    <th>Duration</th>
                                    <th>Rate</th>
                                    <th>Amount</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="timesheet : ${timesheets}"
                                    th:data-clientId="${timesheet.clientId}">
                                    <td data-label="Select">
                                        <span class="cell-value">
                                            <input type="checkbox"
                                                   class="timesheet-select"
                                                   name="timesheetIds"
                                                   th:value="${timesheet.id}"
                                                   th:data-duration="${timesheet.duration}"
                                                   th:data-rate="${timesheet.hourlyRate}">
                                        </span>
                                    </td>
                                    <td data-label="Client">
                                        <span class="cell-value" th:text="${timesheet.clientName}"></span>
                                    </td>
                                    <td data-label="Service Date">
                                        <span class="cell-value" th:text="${#temporals.format(timesheet.serviceDate, 'yyyy-MM-dd')}"></span>
                                    </td>
                                    <td data-label="Duration">
                                        <span class="cell-value" th:text="${timesheet.duration}"></span>
                                    </td>
                                    <td data-label="Rate" class="hourly-rate">
                                        <span class="cell-value" th:text="${#numbers.formatDecimal(timesheet.hourlyRate, 1, 2)}">0.00</span>
                                    </td>
                                    <td data-label="Amount" class="amount">
                                        <span class="cell-value" th:text="${#numbers.formatDecimal(timesheet.value, 1, 2)}">0.00</span>
                                    </td>
                                </tr>
                                </tbody>

                                <tfoot>
                                <tr>
                                    <td colspan="5" class="text-right"><strong>Total Amount:</strong></td>
                                    <td class="total-amount">0.00</td>
                                </tr>
                                </tfoot>

                            </table>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="nav-button">Create Invoice</button>
                            <button type="button" class="nav-button" onclick="window.location.href='/';">Back to Main
                                Page
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:src="@{/js/invoice-items.js}"></script>
</body>
</html>
