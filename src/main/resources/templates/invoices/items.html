<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{head :: head}">
    <!-- Fallback content -->
</head>
<body>
<!-- Back button icon (mobile only, fixed position) -->
<button type="button" class="mobile-back-btn" onclick="window.location.href='/'" aria-label="Back to main menu">
    ‚Üê
</button>

<div class="container my-3">
    <div class="row justify-content-center">
        <div class="col-12 col-md-9">
            <div class="card">
                <div class="card-body p-4">
                    <h2 class="text-center mb-4">Check Invoice Items</h2>

                    <!-- Error message display -->
                    <div th:if="${error}" class="alert alert-danger" role="alert">
                        <span th:text="${error}"></span>
                    </div>

                    <!-- Success message display -->
                    <div th:if="${success}" class="alert alert-success" role="alert">
                        <span th:text="${success}"></span>
                    </div>

                    <form th:object="${createInvoiceRequest}" method="post" th:action="@{/invoices/items}">
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <label>Invoice for:</label>
                                <select class="form-control" th:field="*{clientId}" required>
                                    <option value="">Select client</option>
                                    <option th:each="client : ${clients}"
                                            th:value="${client.id}"
                                            th:text="${client.clientName}">
                                    </option>
                                </select>
                                <label>Seller (Company):</label>
                                <div style="display: flex; gap: 0.75rem; align-items: center;">
                                    <input type="text"
                                           th:value="${currentUser.defaultSeller != null ? currentUser.defaultSeller.name : 'No seller configured'}"
                                           readonly
                                           style="flex: 1; background-color: rgb(45, 48, 50); color: var(--my-yellow); border: 1px solid var(--my-yellow); border-radius: 10px; padding: 10px; cursor: not-allowed;">
                                    <button type="button" class="save-button"
                                            style="margin: 0; padding: 0.775rem 1.2rem; font-size: 0.9rem;"
                                            th:onclick="'window.location.href=\'/sellers/edit/' + ${currentUser.defaultSeller.id} + '\''"
                                            th:if="${currentUser.defaultSeller != null}">
                                        Edit
                                    </button>
                                </div>
                                <input type="hidden" th:field="*{sellerId}">
                                <label>Invoice date:</label>
                                <input type="date" class="form-control"
                                       th:field="*{issueDate}" required>
                            </div>
                        </div>

                        <div class="table-responsive mb-4">
                            <table class="table invoice-items-table">
                                <thead>
                                <tr>
                                    <th>Select</th>
                                    <th>Client</th>
                                    <th>Service Date</th>
                                    <th>Duration</th>
                                    <th>Rate</th>
                                    <th>Amount</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="timesheet : ${timesheets}"
                                    th:data-clientId="${timesheet.clientId}">
                                    <td data-label="Select">
                                        <span class="cell-value">
                                            <input type="checkbox"
                                                   class="timesheet-select"
                                                   th:field="*{timesheetIds}"
                                                   th:value="${timesheet.id}"
                                                   th:data-duration="${timesheet.duration}"
                                                   th:data-rate="${timesheet.hourlyRate}">
                                        </span>
                                    </td>
                                    <td data-label="Client">
                                        <span class="cell-value" th:text="${timesheet.clientName}"></span>
                                    </td>
                                    <td data-label="Service Date">
                                        <span class="cell-value" th:text="${#temporals.format(timesheet.serviceDate, 'yyyy-MM-dd')}"></span>
                                    </td>
                                    <td data-label="Duration">
                                        <span class="cell-value" th:text="${timesheet.duration}"></span>
                                    </td>
                                    <td data-label="Rate" class="hourly-rate">
                                        <span class="cell-value" th:text="${#numbers.formatDecimal(timesheet.hourlyRate, 1, 2)}">0.00</span>
                                    </td>
                                    <td data-label="Amount" class="amount">
                                        <span class="cell-value" th:text="${#numbers.formatDecimal(timesheet.value, 1, 2)}">0.00</span>
                                    </td>
                                </tr>
                                </tbody>

                                <tfoot>
                                <tr>
                                    <td colspan="5" class="text-right"><strong>Total Amount:</strong></td>
                                    <td class="total-amount">0.00</td>
                                </tr>
                                </tfoot>

                            </table>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="nav-button">Create Invoice</button>
                            <button type="button" class="nav-button" onclick="window.location.href='/';">Back to Main
                                Page
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:src="@{/js/invoice-items.js}"></script>
</body>
</html>
